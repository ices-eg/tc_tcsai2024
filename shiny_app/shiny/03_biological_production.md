report_03_biological_production.R
================
colin
2024-03-08

``` r
################################################################################
## 1  Mortality

Amax <- 15
age <- 1:Amax
Ninit <- 1000
Nvec <- numeric(Amax)
M <- rep(0.2, Amax)
Fmort <- c(0, 0, rep(0.3, Amax - 2))

Nvec[1] <- Ninit
for (a in 1:(Amax - 1)) {
  Nvec[a + 1] <- Nvec[a] * exp(-M[a] - Fmort[a])
}


data.frame(age, Nvec, M, Fmort)
```

    ##    age        Nvec   M Fmort
    ## 1    1 1000.000000 0.2   0.0
    ## 2    2  818.730753 0.2   0.0
    ## 3    3  670.320046 0.2   0.3
    ## 4    4  406.569660 0.2   0.3
    ## 5    5  246.596964 0.2   0.3
    ## 6    6  149.568619 0.2   0.3
    ## 7    7   90.717953 0.2   0.3
    ## 8    8   55.023220 0.2   0.3
    ## 9    9   33.373270 0.2   0.3
    ## 10  10   20.241911 0.2   0.3
    ## 11  11   12.277340 0.2   0.3
    ## 12  12    7.446583 0.2   0.3
    ## 13  13    4.516581 0.2   0.3
    ## 14  14    2.739445 0.2   0.3
    ## 15  15    1.661557 0.2   0.3

``` r
################################################################################
## 2  Growth

Winf <- 10
k <- 0.5
t0 <- -0.1
b <- 3

w <- Winf * (1 - exp(-k * (age - t0)))^b
B <- Nvec * w

data.frame(age, Nvec, w, B)
```

    ##    age        Nvec         w          B
    ## 1    1 1000.000000 0.7571391  757.13911
    ## 2    2  818.730753 2.7470391 2249.08540
    ## 3    3  670.320046 4.8884208 3276.80648
    ## 4    4  406.569660 6.6137983 2688.96974
    ## 5    5  246.596964 7.8356920 1932.25785
    ## 6    6  149.568619 8.6454561 1293.08893
    ## 7    7   90.717953 9.1627769  831.22837
    ## 8    8   55.023220 9.4863821  521.97129
    ## 9    9   33.373270 9.6863220  323.26424
    ## 10  10   20.241911 9.8089498  198.55189
    ## 11  11   12.277340 9.8838291  121.34713
    ## 12  12    7.446583 9.9294308   73.94033
    ## 13  13    4.516581 9.9571579   44.97231
    ## 14  14    2.739445 9.9740003   27.32322
    ## 15  15    1.661557 9.9842250   16.58936

``` r
sum(B)
```

    ## [1] 14356.54

``` r
################################################################################
## 3  Recruitment

mat <- c(0, 0, rep(1, Amax - 2))
SSBvec <- B * mat
sum(SSBvec)
```

    ## [1] 11350.31

``` r
alpha <- 1000
beta <- 1000
Tmax <- 25
year <- 1:Tmax

N <- matrix(nrow = Amax, ncol = Tmax)
SSB <- matrix(nrow = Amax, ncol = Tmax)

N[, 1] <- Nvec
SSB[, 1] <- N[, 1] * mat * w

N[1, 2] <- (alpha * sum(SSB[, 1])) / (beta + sum(SSB[, 1]))
for (a in 1:(Amax - 1)) {
  N[a + 1, 2] <- N[a, 1] * exp(-M[a] - Fmort[a])
}
SSB[, 2] <- N[, 2] * mat * w

for (t in 1:(Tmax - 1))
{
  N[1, t + 1] <- (alpha * sum(SSB[, t])) / (beta + sum(SSB[, t]))
  for (a in 1:(Amax - 1)) {
    N[a + 1, t + 1] <- N[a, t] * exp(-M[a] - Fmort[a])
  }
  SSB[, t + 1] <- N[, t + 1] * mat * w
}

round(N)
```

    ##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13] [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25]
    ##  [1,] 1000  919  919  919  917  916  915  914  913   913   913   912   912   912   912   912   912   912   912   912   912   912   912   912   912
    ##  [2,]  819  819  752  752  752  751  750  749  748   748   747   747   747   747   747   747   747   747   747   747   747   747   747   747   747
    ##  [3,]  670  670  670  616  616  616  615  614  613   613   612   612   612   612   611   611   611   611   611   611   611   611   611   611   611
    ##  [4,]  407  407  407  407  374  374  374  373  372   372   372   371   371   371   371   371   371   371   371   371   371   371   371   371   371
    ##  [5,]  247  247  247  247  247  227  227  227  226   226   226   225   225   225   225   225   225   225   225   225   225   225   225   225   225
    ##  [6,]  150  150  150  150  150  150  137  137  137   137   137   137   137   137   137   136   136   136   136   136   136   136   136   136   136
    ##  [7,]   91   91   91   91   91   91   91   83   83    83    83    83    83    83    83    83    83    83    83    83    83    83    83    83    83
    ##  [8,]   55   55   55   55   55   55   55   55   51    51    51    50    50    50    50    50    50    50    50    50    50    50    50    50    50
    ##  [9,]   33   33   33   33   33   33   33   33   33    31    31    31    31    31    31    30    30    30    30    30    30    30    30    30    30
    ## [10,]   20   20   20   20   20   20   20   20   20    20    19    19    19    19    19    19    18    18    18    18    18    18    18    18    18
    ## [11,]   12   12   12   12   12   12   12   12   12    12    12    11    11    11    11    11    11    11    11    11    11    11    11    11    11
    ## [12,]    7    7    7    7    7    7    7    7    7     7     7     7     7     7     7     7     7     7     7     7     7     7     7     7     7
    ## [13,]    5    5    5    5    5    5    5    5    5     5     5     5     5     4     4     4     4     4     4     4     4     4     4     4     4
    ## [14,]    3    3    3    3    3    3    3    3    3     3     3     3     3     3     3     3     3     3     3     3     3     3     3     2     2
    ## [15,]    2    2    2    2    2    2    2    2    2     2     2     2     2     2     2     2     2     2     2     2     2     2     2     2     2

``` r
rec_age <- 1
SR <-
  data.frame(
    year = year[1:(Tmax - rec_age)],
    SSB = colSums(SSB)[1:(Tmax - rec_age)],
    Rec = N[1, (rec_age + 1):Tmax]
  )

SSB.curve <- seq(0, 12000, by = 500)
Rec.curve <- (alpha * SSB.curve) / (beta + SSB.curve)

par(mfrow = c(2, 1), oma = c(0, 0, 0, 3))
plot(SR$year, SR$SSB,
  ylim = c(0, 12000), type = "l", lwd = 2, col = "blue", xlab = "Year",
  ylab = "SSB (t)"
)
lines(SR$year, SR$Rec * 10, lwd = 2, col = "red")
axis(4, at = seq(0, 12000, by = 2000), labels = seq(0, 1200, by = 200))
mtext("Recruitment at age 1 (1000s)", side = 4, line = 3)

plot(SSB.curve, Rec.curve,
  ylim = c(0, 1000), type = "l", xlab = "SSB (t)",
  ylab = "Recruitment at age 1 (1000s)", lwd = 2, col = "red"
)
points(SR$SSB, SR$Rec, type = "o", pch = 16, col = "blue")
```

![](03_biological_production/unnamed-chunk-1-1.png)<!-- -->

``` r
data.frame(SSB.curve, Rec.curve)
```

    ##    SSB.curve Rec.curve
    ## 1          0    0.0000
    ## 2        500  333.3333
    ## 3       1000  500.0000
    ## 4       1500  600.0000
    ## 5       2000  666.6667
    ## 6       2500  714.2857
    ## 7       3000  750.0000
    ## 8       3500  777.7778
    ## 9       4000  800.0000
    ## 10      4500  818.1818
    ## 11      5000  833.3333
    ## 12      5500  846.1538
    ## 13      6000  857.1429
    ## 14      6500  866.6667
    ## 15      7000  875.0000
    ## 16      7500  882.3529
    ## 17      8000  888.8889
    ## 18      8500  894.7368
    ## 19      9000  900.0000
    ## 20      9500  904.7619
    ## 21     10000  909.0909
    ## 22     10500  913.0435
    ## 23     11000  916.6667
    ## 24     11500  920.0000
    ## 25     12000  923.0769

``` r
################################################################################
## 4  Recruitment variability

v <- 1000

## Year 1
N[, 1] <- Nvec
SSB[, 1] <- N[, 1] * mat * w

## Later years
for (t in 1:(Tmax - 1))
{
  N[1, t + 1] <- (alpha * sum(SSB[, t])) / (beta + sum(SSB[, t])) + v * runif(1, -0.5, 0.5)
  for (a in 1:(Amax - 1)) {
    N[a + 1, t + 1] <- N[a, t] * exp(-M[a] - Fmort[a])
  }
  SSB[, t + 1] <- N[, t + 1] * mat * w
}

round(N, 3)
```

    ##           [,1]    [,2]     [,3]     [,4]     [,5]    [,6]    [,7]    [,8]    [,9]   [,10]   [,11]    [,12]    [,13]    [,14]   [,15]    [,16]    [,17]    [,18]   [,19]
    ##  [1,] 1000.000 573.902 1327.044  794.089 1094.222 883.383 924.559 988.486 898.624 644.059 750.961 1005.930 1279.993  800.487 964.578 1186.822 1378.548  599.449 635.679
    ##  [2,]  818.731 818.731  469.871 1086.492  650.145 895.873 723.253 756.965 809.304 735.731 527.311  614.835  823.586 1047.969 655.383  789.730  971.688 1128.660 490.788
    ##  [3,]  670.320 670.320  670.320  384.698  889.544 532.294 733.479 592.150 619.750 662.602 602.365  431.726  503.384  674.295 858.005  536.582  646.576  795.551 924.068
    ##  [4,]  406.570 406.570  406.570  406.570  233.331 539.536 322.853 444.878 359.157 375.898 401.888  365.353  261.855  305.318 408.980  520.406  325.454  392.168 482.526
    ##  [5,]  246.597 246.597  246.597  246.597  246.597 141.523 327.245 195.820 269.832 217.840 227.993  243.758  221.598  158.823 185.185  248.059  315.642  197.398 237.862
    ##  [6,]  149.569 149.569  149.569  149.569  149.569 149.569  85.838 198.484 118.771 163.661 132.126  138.285  147.846  134.406  96.331  112.320  150.456  191.447 119.728
    ##  [7,]   90.718  90.718   90.718   90.718   90.718  90.718  90.718  52.063 120.387  72.038  99.266   80.139   83.874   89.673  81.521   58.428   68.126   91.256 116.118
    ##  [8,]   55.023  55.023   55.023   55.023   55.023  55.023  55.023  55.023  31.578  73.018  43.693   60.208   48.607   50.872  54.390   49.445   35.438   41.320  55.349
    ##  [9,]   33.373  33.373   33.373   33.373   33.373  33.373  33.373  33.373  33.373  19.153  44.288   26.501   36.518   29.481  30.856   32.989   29.990   21.494  25.062
    ## [10,]   20.242  20.242   20.242   20.242   20.242  20.242  20.242  20.242  20.242  20.242  11.617   26.862   16.074   22.149  17.881   18.715   20.009   18.190  13.037
    ## [11,]   12.277  12.277   12.277   12.277   12.277  12.277  12.277  12.277  12.277  12.277  12.277    7.046   16.293    9.749  13.434   10.846   11.351   12.136  11.033
    ## [12,]    7.447   7.447    7.447    7.447    7.447   7.447   7.447   7.447   7.447   7.447   7.447    7.447    4.274    9.882   5.913    8.148    6.578    6.885   7.361
    ## [13,]    4.517   4.517    4.517    4.517    4.517   4.517   4.517   4.517   4.517   4.517   4.517    4.517    4.517    2.592   5.994    3.587    4.942    3.990   4.176
    ## [14,]    2.739   2.739    2.739    2.739    2.739   2.739   2.739   2.739   2.739   2.739   2.739    2.739    2.739    2.739   1.572    3.635    2.175    2.998   2.420
    ## [15,]    1.662   1.662    1.662    1.662    1.662   1.662   1.662   1.662   1.662   1.662   1.662    1.662    1.662    1.662   1.662    0.954    2.205    1.319   1.818
    ##         [,20]    [,21]    [,22]   [,23]    [,24]   [,25]
    ##  [1,] 447.247 1220.041 1163.024 863.795 1178.431 880.977
    ##  [2,] 520.450  366.175  998.885 952.204  707.216 964.818
    ##  [3,] 401.823  426.108  299.798 817.818  779.598 579.019
    ##  [4,] 560.476  243.718  258.448 181.837  496.032 472.850
    ##  [5,] 292.667  339.946  147.822 156.756  110.290 300.858
    ##  [6,] 144.271  177.511  206.188  89.659   95.078  66.894
    ##  [7,]  72.619   87.505  107.666 125.059   54.381  57.667
    ##  [8,]  70.429   44.045   53.074  65.303   75.852  32.984
    ##  [9,]  33.571   42.718   26.715  32.191   39.608  46.007
    ## [10,]  15.201   20.362   25.909  16.203   19.525  24.024
    ## [11,]   7.907    9.220   12.350  15.715    9.828  11.842
    ## [12,]   6.692    4.796    5.592   7.491    9.532   5.961
    ## [13,]   4.465    4.059    2.909   3.392    4.543   5.781
    ## [14,]   2.533    2.708    2.462   1.764    2.057   2.756
    ## [15,]   1.468    1.536    1.642   1.493    1.070   1.248

``` r
rec_age <- 1
SR <-
  data.frame(
    year = year[1:(Tmax - rec_age)],
    SSB = colSums(SSB)[1:(Tmax - rec_age)],
    Rec = N[1, (rec_age + 1):Tmax]
  )

SSB.curve <- seq(0, 15000, by = 500)
Rec.curve <- (alpha * SSB.curve) / (beta + SSB.curve)

plot(SR$year, SR$SSB,
  ylim = c(0, 15000), type = "l", lwd = 2, col = "blue", xlab = "Year",
  ylab = "SSB (t)"
)
lines(SR$year, SR$Rec * 10, lwd = 2, col = "red")
axis(4, at = seq(0, 12000, by = 2000), labels = seq(0, 1200, by = 200))
mtext("Recruitment at age 1 (1000s)", side = 4, line = 3)

plot(SSB.curve, Rec.curve,
  xlim = c(0, 15000), ylim = c(0, 1500), type = "l",
  xlab = "SSB (t)", ylab = "Recruitment at age 1 (1000s)", lwd = 2, col = "red"
)
points(SR$SSB, SR$Rec, type = "o", pch = 16, col = "blue")
```

![](03_biological_production/unnamed-chunk-1-2.png)<!-- -->
